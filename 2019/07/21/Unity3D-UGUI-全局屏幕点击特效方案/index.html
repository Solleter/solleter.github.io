<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="日常记录"><title>Unity3D UGUI 全局屏幕点击特效方案 | F社</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a><a class="sidebar-nav-item" href="/about">About</a><a class="sidebar-nav-item" href="/weekly">Weekly</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/UGUI/">UGUI</a><a class="post-tag-link" href="/tags/Unity3D/">Unity3D</a><a class="post-tag-link" href="/tags/游戏开发/">游戏开发</a></div><div class="post-time">2019-07-21</div></div></div><div class="container post-header"><h1>Unity3D UGUI 全局屏幕点击特效方案</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#先看效果图"><span class="toc-number">1.</span> <span class="toc-text">先看效果图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在实现之前，首先要准备好的东西"><span class="toc-number">2.</span> <span class="toc-text">在实现之前，首先要准备好的东西</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#下面是UI结构各层的设置"><span class="toc-number">3.</span> <span class="toc-text">下面是UI结构各层的设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#UIRoot"><span class="toc-number">3.0.1.</span> <span class="toc-text">UIRoot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UICamera"><span class="toc-number">3.0.2.</span> <span class="toc-text">UICamera</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Canvas"><span class="toc-number">3.0.3.</span> <span class="toc-text">Canvas</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FXContainer"><span class="toc-number">3.0.4.</span> <span class="toc-text">FXContainer</span></a></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#下面是挂在-FXContainer-上的脚本"><span class="toc-number">4.</span> <span class="toc-text">下面是挂在 FXContainer 上的脚本</span></a></li></details></div><div class="container post-content"><p>在游戏开发中，经常会用到全局的屏幕点击特效，就是玩家在点击屏幕的时候，在屏幕最上层，播放一个特效，这个教程使用UGUI来实现，UI使用独立的相机渲染。</p>
<h2 id="先看效果图"><a href="#先看效果图" class="headerlink" title="先看效果图"></a><strong>先看效果图</strong></h2><p><img src="https://i.loli.net/2019/07/21/5d340f1566f1f23086.gif" alt="image"></p>
<p><a href="https://github.com/Solleter/ScreenTapFX" target="_blank" rel="noopener">示例工程 -&gt; Github</a></p>
<blockquote>
<p>示例工具中用到的特效资源来自于 Unity 的 AssetStore 免费资源 JMO Assets</p>
</blockquote>
<h2 id="在实现之前，首先要准备好的东西"><a href="#在实现之前，首先要准备好的东西" class="headerlink" title="在实现之前，首先要准备好的东西"></a><strong>在实现之前，首先要准备好的东西</strong></h2><ol>
<li>准备好一个要使用的粒子特效<ul>
<li>将特效 Prefab 的 Layer 全部设置成UI</li>
<li>将特效Prefab中所有的 Particle System 组件上 Renderer 属性中的 SortingLayer 设置为UI，如果没有这一层，则先添加</li>
<li>然后将 Renderer 属性中的 Order in Layer 设置为100 ，确保比所有的UI层级高</li>
</ul>
</li>
<li>创建UI结构<ul>
<li>UIRoot (一个空物体，用作UI的Root)<ul>
<li>UICamera (用于渲染UI的相机)</li>
<li>Canvas (用于显示UI元素)<ul>
<li>FXContainer (空物体，用作屏幕特效的父物体)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编写播放逻辑</li>
</ol>
<h2 id="下面是UI结构各层的设置"><a href="#下面是UI结构各层的设置" class="headerlink" title="下面是UI结构各层的设置"></a><strong>下面是UI结构各层的设置</strong></h2><blockquote>
<p>UI层级结构中的那个Background忽略就好，就是随便加的一个 Image 作为背景</p>
</blockquote>
<ol>
<li><h4 id="UIRoot"><a href="#UIRoot" class="headerlink" title="UIRoot"></a>UIRoot</h4> <img src="https://i.loli.net/2019/07/21/5d3408ae38d9f39338.png" alt="image"></li>
<li><h4 id="UICamera"><a href="#UICamera" class="headerlink" title="UICamera"></a>UICamera</h4> <img src="https://i.loli.net/2019/07/21/5d3409065c4f353338.png" alt="image"></li>
<li><h4 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h4> <img src="https://i.loli.net/2019/07/21/5d34096b246bc83909.png" alt="image"></li>
<li><h4 id="FXContainer"><a href="#FXContainer" class="headerlink" title="FXContainer"></a>FXContainer</h4> <img src="https://i.loli.net/2019/07/21/5d3409b49164450657.png" alt="image"></li>
</ol>
<h2 id="下面是挂在-FXContainer-上的脚本"><a href="#下面是挂在-FXContainer-上的脚本" class="headerlink" title="下面是挂在 FXContainer 上的脚本"></a><strong>下面是挂在 FXContainer 上的脚本</strong></h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ScreenTapFX</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 屏幕特效原始资源</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> GameObject fxSample;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 屏幕特效的生命时长，超过后会进行缓存</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> fxLifeTime = <span class="number">1.0f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 屏幕特效的容器（父对象）</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> RectTransform fxContainer;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 屏幕特效渲染使用的相机</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> Camera fxRenderCamera;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Queue&lt;GameObject&gt; pool = <span class="keyword">new</span> Queue&lt;GameObject&gt;(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">private</span> List&lt;GameObject&gt; activatedFXList = <span class="keyword">new</span> List&lt;GameObject&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span>(fxSample == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.LogErrorFormat(<span class="string">"没有找到屏幕特效"</span>);</span><br><span class="line">            <span class="keyword">this</span>.enabled = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            fxSample.SetActive(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = activatedFXList.Count - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i)</span><br><span class="line">        &#123;</span><br><span class="line">            GameObject fx = activatedFXList[i];</span><br><span class="line">            <span class="keyword">float</span> fxTime = <span class="keyword">float</span>.Parse(fx.name);</span><br><span class="line">            <span class="keyword">if</span>(Time.time - fxTime &gt; fxLifeTime)</span><br><span class="line">            &#123;</span><br><span class="line">                RecycleFX(fx);</span><br><span class="line">                activatedFXList.RemoveAt(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Application.isMobilePlatform)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Input.touchCount; ++i)</span><br><span class="line">            &#123;</span><br><span class="line">                Touch touch = Input.GetTouch(i);</span><br><span class="line">                <span class="keyword">if</span>(touch.phase == TouchPhase.Began)</span><br><span class="line">                &#123;</span><br><span class="line">                    PlayFX(touch.position);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Input.GetMouseButtonDown(<span class="number">0</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                PlayFX(Input.mousePosition);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PlayFX</span>(<span class="params">Vector2 tapPos</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        GameObject fx = CreateFX();</span><br><span class="line">        fx.name = Time.time.ToString();</span><br><span class="line">        activatedFXList.Add(fx);</span><br><span class="line"></span><br><span class="line">        RectTransform fxRectTrans = fx.GetComponent&lt;RectTransform&gt;();</span><br><span class="line">        Vector2 fxLocalPos;</span><br><span class="line">        RectTransformUtility.ScreenPointToLocalPointInRectangle(fxContainer, tapPos, fxRenderCamera, <span class="keyword">out</span> fxLocalPos);</span><br><span class="line">        fxRectTrans.SetParent(fxContainer);</span><br><span class="line">        fxRectTrans.anchoredPosition3D = fxLocalPos;</span><br><span class="line">        fx.SetActive(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> GameObject <span class="title">CreateFX</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        GameObject newFX = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(pool.Count &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            newFX = pool.Dequeue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            newFX = Instantiate(fxSample);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newFX;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">RecycleFX</span>(<span class="params">GameObject fx</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        fx.SetActive(<span class="literal">false</span>);</span><br><span class="line">        pool.Enqueue(fx);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div><script type="text/x-mathjax-config">
   MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
        tex2jax: { inlineMath: [ ["$", "$"], ["\\(","\\)"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno",skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']},
        TeX: {  noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, Macros: { href: "{}" } },
        messageStyle: "none"
    }); 
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><div class="post-main post-comment"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'sexy-game-boy';
var disqus_identifier = '2019/07/21/Unity3D-UGUI-全局屏幕点击特效方案/';
var disqus_title = 'Unity3D UGUI 全局屏幕点击特效方案';
var disqus_url = 'http://f.mayopy.com/2019/07/21/Unity3D-UGUI-全局屏幕点击特效方案/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-140200191-1');ga('send','pageview');</script></body></html>